
@{
    ViewData["Title"] = "TEC_Approved";
    Layout = "_Layout";
}

@*<html>
<head>

</head>
<body>*@

<div class="container-fluid">


    <div class="card">
        @*<div class="fb-image-lg profile-bgx">
        </div>
        <div class="card-body">
            <div class="row justify-content-center">
                <h1>TEC APPROVED</h1>
            </div>*@
        <div class="fb-image-lg profile-bg2   ">

        </div>
        <div class="card-body">
            <div class="row justify-content-center">
                <div class="fb-image-profilex">
                    <h1 class="text-uppercase">TEC APPROVED</h1>
                </div>
            </div>

            <div class="row justify-content-center">
                <div class="col justify-content-center overflow-auto">



                    <table class="table table-hover table-sm bg-white w-100" id="MyTable">
                        <thead class="bg-light">
                            <tr>
                                <th style="text-align:center;" class="text-wrap">DocNo</th>
                                <th style="text-align:center;" class="text-wrap"> Req OperatorID </th>
                                <th style="text-align:center;" class="text-wrap"> Req Date </th>
                                <th style="text-align:center;" class="text-wrap"> Total Job </th>
                                <th style="text-align:center;" class="text-wrap"> Detail </th>

                            </tr>
                        </thead>
                        <tbody></tbody>

                    </table>
                </div>
            </div>
        </div>
    </div>




    <div class="modal fade text-center rounded  border border-dark " style="z-index:99999999;" id="Modal_Compare" role="dialog" aria-labelledby="Modal_Compare" aria-hidden="true">

        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content bg-light ">
                <div class="modal-header text-center rounded " style="background-repeat:no-repeat; background-size:cover; background-position:center center; height:60px;width:100%; border-bottom:2px #e96514 solid ">
                    <h3>Detail</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true" class="btn btn-secondary">&times;</span>
                    </button>
                </div>


                <div class="modal-body ">
                    <div style="overflow:auto">


                        <table class="table table-sm table-bordered table-striped " style="font-size:small; color:black; width:100%; background-color:#fff;" id="MyTable_Compare">

                            <thead class="bg-light">
                                <tr>
                                    <th class="text-wrap"> Catagory </th>
                                    <th class="text-wrap text-dark"> New </th>
                                    <th class="text-wrap"> Present </th>

                                </tr>
                            </thead>

                        </table>

                    </div>
                </div>




            </div>
        </div>
    </div>

    @*//-----------------------------*@

    <div class="modal fade mt-5 text-center rounded" id="Modal_Detail" tabindex="-1" role="dialog" aria-labelledby="ModalLabel_Detail" aria-hidden="true">



        <div class="modal-dialog  rounded" role="document" style="max-width:1200px;">
            <div class="modal-content">
                <div class="modal-header text-center rounded bg-light " style="background-repeat:no-repeat; background-size:cover; background-position:center center; height:60px;width:100%; border-bottom:2px #e96514 solid ">

                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true" class="btn btn-secondary">&times;</span>
                    </button>
                </div>

                <div class="modal-body ">


                    <div class="card">
                        <div class="card-header justify-content-center">

                            <h2> DocNO :     <label id="LB_DocNO" class="text-dark">       </label> </h2>


                        </div>



                        <div class="card-body justify-content-center" style="height:400px;">
                         


                                <div class="col  justify-content-center pl-md-10 pr-md-10 pt-2 pb-2 " id="DetailMain">

                                    <table class="table table-sm table-bordered table-striped " style="font-size:small; color:black; width:100%; background-color:#fff;" id="MyTable_Detail">
                                        <thead class="bg-light">
                                            <tr>

                                                @*<th style="text-align:center;" class="text-wrap">nbr</th>
                        <th style="text-align:center;" class="text-wrap"> docNo </th>*@

                                                <th><input class="select-checkbox" value="1" id="CB_select_all" type="checkbox" /> All </th>
                                                <th style="text-align:center;" class="text-wrap"> Nbr </th>
                                                <th style="text-align:center;" class="text-wrap"> operatorID </th>
                                                <th style="text-align:center;" class="text-wrap text-dark"> sectionCode </th>
                                                <th style="text-align:center;" class="text-wrap text-dark">sectionAttribute</th>
                                                <th style="text-align:center;" class="text-wrap text-dark"> operatorGroup </th>
                                                <th style="text-align:center;" class="text-wrap text-dark"> license </th>
                                                <th style="text-align:center;" class="text-wrap text-dark"> active </th>
                                                <th style="text-align:center;" class="text-wrap"> reqOperatorID </th>
                                                <th style="text-align:center;" class="text-wrap"> reqDate </th>
                                                <th style="text-align:center;" class="text-wrap">  </th>


                                            </tr>
                                        </thead>
                                        <tbody></tbody>

                                    </table>



                                </div>

                         



                        </div>


                    </div>

                    <div class="modal-footer">

                        @*<div class="row justify-content-end">

                            <div class="col-5 text-center">*@

                        <button class="btn btn-success  btn_response " id="BTN_Approved">
                            <i class="fas fa-search"></i> Approve
                        </button>

                        @*</div>


                            </div>*@

                    </div>


                </div>



            </div>
        </div>





    </div>



</div>











    @section scripts{
        @*<script src="~/lib/jquery/jquery.min.js"></script>*@




        @*<link href="~/lib/datatables/Css/jquery.dataTables.min.css" rel="stylesheet" />
            <script src="~/lib/datatables/Js/jquery.dataTables.min.js"></script>
                <script src="~/lib/DataTables/js/dataTables.responsive.js"></script>*@



        <script src="~/lib/bootstrap/js/bootstrap.js"></script>



        <link href="~/lib/DataTables/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/colReorder.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/fixedColumns.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/fixedHeader.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/keyTable.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/responsive.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/rowGroup.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/rowReorder.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/scroller.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/select.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/buttons.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/buttons.dataTables.min.css" rel="stylesheet" />

        <script src="~/lib/DataTables/js/jquery.dataTables.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.bootstrap4.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.colReorder.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.fixedHeader.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.keyTable.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.responsive.min.js"></script>
        <script src="~/lib/DataTables/js/responsive.bootstrap4.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.rowGroup.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.rowReorder.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.scroller.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.select.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.buttons.min.js"></script>
        <script src="~/lib/DataTables/js/buttons.bootstrap.min.js"></script>
        <script src="~/lib/DataTables/js/buttons.flash.min.js"></script>
        <script src="~/lib/DataTables/js/buttons.html5.min.js"></script>
        <script src="~/lib/DataTables/js/buttons.print.min.js"></script>






        <script type="text/javascript">

            var TableTarget;

            var TableApprove;


            $(document).ready(function () {
                ShowGrid()



            });





            function ShowGrid() {
                debugger

                if (TableTarget != null) {
                    TableTarget.destroy();
                }

                try {

                    TableTarget = $("#MyTable").DataTable({

                        searching: false,
                        ordering: true,
                        serverSide: true,
                        processing: true,
                        // cache: true,
                        ajax: ({
                            type: "post",
                            url: "../TEC_Management/Load_TEC_Approved_Detail",
                            dataSrc: "data",
                            //  data: { OPID: OPID },
                            dataType: "json",

                        }),

                        dom: '<"top"l>rt<"bottom">ip<"clear">',
                        columns: [

                            { data: "docNo", name: "docNo", class: "text-wrap text-center" },
                            { data: "reqOperatorID", name: "reqOperatorID", class: "text-wrap text-center" },
                            { data: "reqDate", name: "reqDate", class: "text-wrap text-center" },
                            { data: "totalJob", name: "totalJob", class: "text-wrap text-center" },

                            {
                                data: null,

                                render: function (data, type, row) {
                                    var Target = row.docNo


                                    return "<a href='#' class='btn btn-info  btn-sm text-white btn_response' onclick=showdetail('" + encodeURIComponent(Target) + "'); >Detail</a>";

                                }, class: "text-wrap text-center"
                            },



                        ],
                        order: [0, "asc"],

                    });

                } catch (e) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: ("table:" + e)
                    })


                }
                finally {



                }



            }






            function showdetail(DocNo) {
                $("#CB_Approve.CB").prop("checked", false)
                DocNo_ = decodeURIComponent(DocNo)

                if (TableApprove != null) {
                    TableApprove.destroy();
                }


                try {

                    TableApprove = $("#MyTable_Detail").DataTable({
                        info: false,
                        searching: false,
                        ordering: false,
                        serverSide: true,
                        processing: true,
                         cache: true,
                        ajax: ({
                            type: 'POST',
                            url: '../TEC_Management/GetFullDetail',
                            dataType: 'json',
                            dataSrc: "data",
                            data: { DocNo: DocNo_ },
                        }),


                        dom: '<"top"><"bottom"><"clear">',
                        columns: [

                        

                            {
                                //data: "Delete",
                                //render: function (data, type, row)
                                data: null,
                                className: "center",
                                "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
                                    var Target = oData.nbr + ',' + oData.reqOperatorID

                                    $(nTd).html('<input type="checkbox"   class="CB" id="CB_Approve" name="CB_Approve" onchange="CB_Change()" value="' + Target + '"  />');

                                }, className: "dt-body-center"
                            },




                            { data: "nbr", name: "Nbr", class: "text-wrap text-center" },
                            { data: "operatorID", name: "operatorID", class: "text-wrap text-center" },
                            { data: "new_Section", name: "New_Section", class: "text-wrap text-center text-danger" },
                            { data: "new_SectionAttribute", name: "New_SectionAttribute", class: "text-wrap text-center text-danger" },
                            { data: "new_GroupName", name: "New_GroupName", class: "text-wrap text-center text-danger" },
                            { data: "new_License", name: "New_License", class: "text-wrap text-center text-danger" },
                            { data: "new_Active", name: "New_Active", class: "text-wrap text-center text-danger" },
                            { data: "reqOperatorID", name: "ReqOperatorID", class: "text-wrap text-center" },
                            { data: "reqDate", name: "reqDate", class: "text-wrap text-center" },
                         //   { data: "changeOperatorID", name: "changeOperatorID", class: "text-wrap text-center" },
                           // { data: "changeDate", name: "changeDate", class: "text-wrap text-center" },
                            {
                                data: null,

                                render: function (data, type, row) {
                                    var Target = row.nbr


                                    return "<a href='#' class='btn btn-info btn-sm text-white btn_response'   onclick=ShowComepare('" + Target + "'); >Compare</a>";

                                }, class: "text-wrap text-center"
                            },

                         

                        ],
                        order: [1, "asc"],



                    });

                } catch (e) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: ("table:" + e)
                    })


                }
                finally {

                    $('#LB_DocNO').text(DocNo_);
                    $('#Modal_Detail').modal('show')

                }



            }

            $('#CB_select_all').click(function () {
       
                if ($(this).is(":checked")) {
                    $("#CB_Approve.CB").prop("checked", true)
                }
                else {
                    $("#CB_Approve.CB").prop("checked", false)
                }
            });



            function ShowComepare(Nbr) {

                try {
                    if (TableTarget != null) {
                        TableTarget.destroy();
                    }
                
                TableTarget = $("#MyTable_Compare").DataTable({

                    searching: false,
                    ordering: true,
                    serverSide: true,
                    processing: true,
                    // cache: true,
                    ajax: ({
                        type: "post",
                        url: "../TEC_Management/ShowComepare",
                        dataSrc: "data",
                        data: { Nbr: Nbr },
                        dataType: "json",

                    }),

                    dom: '<"top"><"bottom"><"clear">',
                    columns: [

                        { data: "catagory", name: "Catagory", class: "text-wrap text-center" },
                        { data: "new", name: "New", class: "text-wrap text-center text-danger" },
                        { data: "present", name: "present", class: "text-wrap text-center" },                    


                    ],
                    order: [0, "asc"],

                });

            } catch (e) {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: ("table:" + e)
                })


            }
            finally {

                    $('#Modal_Compare').modal('show')

            }



            }



            function CB_Change() {
              
                $("#CB_select_all").prop("checked", false)

            }
            //$('#selectall').toggle(
            //    function () {
            //        $('#friendslist .tf').prop('checked', true);
            //    },
            //    function () {
            //        $('#friendslist .tf').prop('checked', false);
            //    }
            //);


        $('#BTN_Approved').click(function (event) {

        var MakerID = '@User.Identity.Name';


        Swal.fire({
            icon: 'warning',
            title: 'Are you sure?',
            text: "Are you sure you want to Approve Data ?",
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, Do it!'

        }).then(function (result) {
            if (result.value) {

                ApproveData( MakerID)
            }

        })

            });



            function ApproveData(MakerID) {



                var arrdata = TableApprove.$('input, select').serializeArray();


                
                var Nbr_Array = new Array();
                var arrtemp = new Array();

                var i;

                var reqOperatorID;

                if (arrdata.length != 0) {




                    for (i = 0; i < arrdata.length; i++) {
                       

                        arrtemp = arrdata[i].value.split(',');
                        Nbr_Array.push(arrtemp[0]);
                        reqOperatorID = arrtemp[1];
                        arrtemp = [];
                    }





                    $.ajax({
                        type: 'post',
                        url: "../TEC_Management/ApproveData",
                        dataSrc: "data",
                        data: { Nbr_Array: Nbr_Array, MakerID: MakerID, reqOperatorID: reqOperatorID },
                        dataType: 'json',
                        success: function (response) {
                            if (response.success == true) {
                                Swal.fire({
                                    position: 'top-mid',
                                    icon: 'success',
                                    title: (response.responseText),
                                    showConfirmButton: true,
                                    //   timer: 1700
                                }).then(function (result) {
                                    // if (result.value) {

                                    $('#Modal_Detail').modal('hide')
                                    ShowGrid()

                                });



                            } else {
                                Swal.fire({
                                    text: (response.responseText),
                                    icon: 'error',
                                    title: 'Oops...',
                                    //     timer: 1700,
                                }).then(function () {
                                    return false;
                                });
                            }

                        },
                        error: function (ex) {
                      
                            Swal.fire({
                                text: ('MakeDataTemp :' + ex.statusText),
                                icon: 'error',
                                title: 'Oops...',
                                //     timer: 1700,
                            }).then(function () {
                                return false;
                            });
                        },


                    });


                } else {

                    Swal.fire({
                        text: ("Plase select value"),
                        icon: 'error',
                        title: 'Oops...',
                        //     timer: 1700,
                    }).then(function () {
                        return false;
                    });



                }
            }





        </script>
    }


@*</body>
</html>*@